<style>
    .preview{ float:left;width: 100px; max-height: 100px; }
    .preview img { width: 100%;  }
    .fileinput-button { float: left; }
    .value.submit{ display:none; }
</style>
<script type="text/javascript" src="{$wa_url}wa-content/js/jquery-plugins/fileupload/jquery.iframe-transport.js"></script>
<script type="text/javascript" src="{$wa_url}wa-content/js/jquery-plugins/fileupload/jquery.fileupload.js"></script>
<script type="text/javascript" src="{$wa_app_static_url}plugins/texture/js/script.js"></script>
<h1>Текстура к характеристикам</h1>
<div     class="fields form">
    <form action="?module=plugins&id=texture&action=save" method="post" id="plugins-settings-form">

        <p{if !$settings.status} style="display:none" {/if}>
            {ldelim}<b>shopTexturePlugin::display($product)</b>{rdelim}  - Код хелпера вывода, данный код позволяет вывести плагин в произвольном месте.<br/> 
            Перейдите в редактор Вашей темы дизайна, выберете шаблон product.cart.html и добавьте код хелпера в шаблон.<br/> 
            Плагин будет выводится в том месте темы оформления, где был размещен хелпер вывода.<br/>
            Чтобы плагин не выводился в двух местах одновременно: в стандартном и там, где размещен хелпер вывода, необходимо отключить "Вывод плагина в стандартном месте".
        </p>

        {$wa->csrf()}
        {$feature_s=$settings.feature}

        <div class="field-group">
            <div class="field">
                <div class="name">
                    Статус плагина
                </div>
                <div class="value no-shift s-ibutton-checkbox">
                    <input type="hidden" name="shop_texture[status]" value="0" >
                    <input type="checkbox" id="ibutton-status" name="shop_texture[status]" value="1"{if $settings.status} checked{/if}>
                </div>
            </div>
        </div>
        <div class="field-group"{if !$settings.status} style="display:none"{/if}>
            <div class="field">
                <div class="name">
                    Вывод плагина в стандартном месте
                </div>
                <div class="value no-shift s-ibutton-checkbox">
                    <input type="hidden" name="shop_texture[default_output]" value="0" >
                    <input type="checkbox" class="ibutton" name="shop_texture[default_output]" value="1"{if $settings.default_output} checked{/if}>
                    <p class="gray">
                        <i class="hint"></i>
                        Вы можете отключить стандартный вывод, это может быть полезно если вы используете хелпер вывода
                    </p>
                </div>
            </div>
        </div>
        <div class="field-group"{if !$settings.status} style="display:none"{/if}>
            <div class="field">
                <div class="name">
                    Fancybox
                </div>
                <div class="value no-shift s-ibutton-checkbox">
                    <input type="hidden" name="shop_texture[fancybox]" value="0" >
                    <input type="checkbox" class="ibutton" name="shop_texture[fancybox]" value="1"{if $settings.fancybox} checked{/if}>
                    <p class="gray">
                        <i class="hint"></i>
                        Если у вас не установлен "fancybox", то включите наш
                    </p>
                </div>
            </div>
        </div>
        <hr>
        <div{if !$settings.status} style="display:none"{/if}>
            {foreach $features as $id => $feature}
                {if $feature.multiple}
                    <div class="field-group">
                        <div class="field">
                            <div class="name">
                                {$feature.name|escape}
                            </div>
                            <div class="value">
                                <input type="hidden" name="shop_texture[feature][{$feature.id}][status]" value="0" >
                                <input type="checkbox" class="ibutton-status-parent" name="shop_texture[feature][{$feature.id}][status]" value="1"{if $feature_s[$feature.id].status} checked{/if} />
                            </div>
                        </div>
                        {foreach $feature.values as $id_value => $value}
                            <div class="field feature_{$feature.id}_{$id_value}" {if !$feature_s[$feature.id].status} style="display:none" {/if}>
                                <div class="name"></div>
                                <div class="value">
                                    <div class="preview">
                                        {if !empty($feature_s[$feature.id].img[$id_value])}
                                            <img src="{$image_url}{$feature_s[$feature.id].img[$id_value]}" />
                                        {/if}
                                    </div>
                                    <div>{$value}</div>
                                    <a class="fileinput-button" href="javascript:void(0);" style="overflow: hidden; float: left; display: inline-block;">
                                        <i class="icon16 add"></i>
                                        <input  class="fileupload"  accept="image/jpeg,image/png,image/gif" type="file" name="texture">
                                        <input type="hidden" class="value_feature" name="shop_texture[feature][{$feature.id}][img][{$id_value}]" data-feature-id="{$feature.id}" data-feature-value="{$id_value}"  value="{$feature_s[$feature.id].img[$id_value]}" />
                                    </a>
                                    <a class="deleteButton" {if empty($feature_s[$feature.id].img[$id_value])}style="display:none;"{/if} href="javascript:void(0);"><i class="icon16 delete" title="Удалить"></i></a>
                                    <div class="response"></div>
                                </div>
                            </div>
                        {/foreach}
                    </div>
                {/if}
            {/foreach}
        </div>
        <div class="field-group"{if !$settings.status} style="display:none"{/if}>
            <div class="field">
                <div class="value submit">
                    <input type="submit" class="button green" value="Сохранить">
                    <span id="plugins-settings-form-status" style="display:none">
                        <i style="vertical-align:middle" class="icon16 yes"></i> [`Saved`]
                    </span>
                </div>
            </div>
        </div>
    </form>
</div>

{literal}
    <script type="text/javascript">

        $(function () {
            $('#ibutton-status').iButton({labelOn: "", labelOff: "", className: 'mini'}).change(function () {
                var self = $(this);
                var enabled = self.is(':checked');
                if (enabled) {
                    self.closest('.field-group').siblings().show(200);
                } else {
                    self.closest('.field-group').siblings().hide(200);
                }
                var f = $("#plugins-settings-form");
                $.post(f.attr('action'), f.serialize());
            });
            $('.ibutton').iButton({labelOn: "", labelOff: "", className: 'mini'}).change(function () {
                var f = $("#plugins-settings-form");
                $.post(f.attr('action'), f.serialize());
            });

            $('.ibutton-status-parent').iButton({labelOn: "", labelOff: "", className: 'mini'}).change(function () {
                var self = $(this);
                var enabled = self.is(':checked');
                if (enabled) {
                    self.closest('.field').siblings().show(200);
                } else {
                    self.closest('.field').siblings().hide(200);
                }
                var f = $("#plugins-settings-form");
                $.post(f.attr('action'), f.serialize());
            });
        });
    </script>
{/literal}